```bash
micro@Micro ~/D/t/t/new> ruby tests/stats_benchmarks.rb
Measure Mode: wall_time
Thread ID: 70251463237120
Fiber ID: 70251480421020
Total Time: 38.92179298400879
Sort by: total_time

  %total   %self      total       self       wait      child            calls     name
--------------------------------------------------------------------------------
 100.00%   0.00%     38.922      0.000      0.000     38.922                1     Object#cpu_profiling
                     38.922      0.000      0.000     38.922              1/1     Object#work
--------------------------------------------------------------------------------
                     38.922      0.000      0.000     38.922              1/1     Object#cpu_profiling
 100.00%   0.00%     38.922      0.000      0.000     38.922                1     Object#work
                     38.916      0.000      0.000     38.916              1/1     Stats#call
                      0.006      0.000      0.000      0.006        1/1000003     Class#new
--------------------------------------------------------------------------------
                     38.916      0.000      0.000     38.916              1/1     Object#work
  99.98%   0.00%     38.916      0.000      0.000     38.916                1     Stats#call
                     38.916      0.000      0.000     38.916              1/1     <Class::IO>#open
--------------------------------------------------------------------------------
                     38.916      0.000      0.000     38.916              1/1     Stats#call
  99.98%   0.00%     38.916      0.000      0.000     38.916                1     <Class::IO>#open
                     38.914      1.790      0.000     37.124              1/3     Kernel#loop
                      0.001      0.001      0.000      0.000              1/1     File#initialize
                      0.000      0.000      0.000      0.000              1/1     IO#close
                      0.000      0.000      0.000      0.000              1/1     Enumerable#count
                      0.000      0.000      0.000      0.000         1/500001     <Module::Oj>#dump
                      0.000      0.000      0.000      0.000              1/1     String#[]
                      0.000      0.000      0.000      0.000         1/500001     Array#join
                      0.000      0.000      0.000      0.000              1/1     Enumerable#slice_before
                      0.000      0.000      0.000      0.000        4/1500003     IO#write
                      0.000      0.000      0.000      0.000              1/1     IO#closed?
                      0.000      0.000      0.000      0.000              1/1     Enumerator#each
                      0.000      0.000      0.000      0.000              1/2     SortedSet#to_a
--------------------------------------------------------------------------------
                      0.001      0.000      0.000      0.001              2/3     <Module::Gem::Util>#traverse_parents
                     38.914      1.790      0.000     37.124              1/3     <Class::IO>#open
  99.98%   4.60%     38.915      1.790      0.000     37.125                3     Kernel#loop
                     11.761      0.491      0.000     11.270  1000000/1000003     Class#new
                      9.337      0.860      0.000      8.477    500000/500000     UserSessions#stats
                      7.056      0.589      0.000      6.467    500000/500000     Stats#update_global_stat
                      4.261      2.775      0.000      1.486    500000/500001     <Module::Oj>#dump
                      3.351      0.235      3.116      0.000    500000/500000     Enumerator#peek
                      0.941      0.941      0.000      0.000  1499999/1500003     IO#write
                      0.336      0.336      0.000      0.000    500000/500000     User#key
                      0.083      0.083      0.000      0.000    500000/500000     Enumerator#next
                      0.001      0.000      0.000      0.000            14/14     <Class::Dir>#chdir
                      0.000      0.000      0.000      0.000            14/16     <Class::File>#expand_path
                      0.000      0.000      0.000      0.000              1/3     Module#===
--------------------------------------------------------------------------------
                      0.000      0.000      0.000      0.000        1/1000003     Set#initialize
                      0.006      0.000      0.000      0.006        1/1000003     Stats#initialize
                      0.006      0.000      0.000      0.006        1/1000003     Object#work
                     11.761      0.491      0.000     11.270  1000000/1000003     Kernel#loop
  30.23%   1.26%     11.767      0.491      0.000     11.276          1000003    *Class#new
                      9.551      0.241      0.000      9.311    500000/500000     UserSessions#initialize
                      1.719      0.262      0.000      1.457    500000/500000     User#initialize
                      0.006      0.000      0.000      0.006              1/1     Stats#initialize
                      0.006      0.000      0.000      0.006              1/2     SortedSet#initialize
                      0.000      0.000      0.000      0.000              1/1     Hash#initialize
--------------------------------------------------------------------------------
                      9.551      0.241      0.000      9.311    500000/500000     Class#new
  24.54%   0.62%      9.551      0.241      0.000      9.311           500000     UserSessions#initialize
                      9.311      1.015      0.000      8.296    500000/500000     Array#map!
--------------------------------------------------------------------------------
                      9.337      0.860      0.000      8.477    500000/500000     Kernel#loop
  23.99%   2.21%      9.337      0.860      0.000      8.477           500000     UserSessions#stats
                      2.760      0.365      0.000      2.396   500000/1000000     UserSessions#browsers
                      1.527      0.420      0.000      1.107    500000/500000     UserSessions#total_time
                      1.401      0.229      0.000      1.172    500000/500000     UserSessions#always_used_chrome?
                      1.372      0.288      0.000      1.085    500000/500000     UserSessions#sessions_dates
                      0.716      0.354      0.000      0.362    500000/500000     UserSessions#longest_session
                      0.566      0.229      0.000      0.337    500000/500000     UserSessions#used_ie?
                      0.134      0.134      0.000      0.000   500000/1000000     UserSessions#sessions_count
--------------------------------------------------------------------------------
                      9.311      1.015      0.000      8.296    500000/500000     UserSessions#initialize
  23.92%   2.61%      9.311      1.015      0.000      8.296           500000     Array#map!
                      8.296      3.318      0.000      4.978  2750940/2750940     <Module::Parsers>#parse_session
--------------------------------------------------------------------------------
                      8.296      3.318      0.000      4.978  2750940/2750940     Array#map!
  21.31%   8.52%      8.296      3.318      0.000      4.978          2750940     <Module::Parsers>#parse_session
                      3.341      3.341      0.000      0.000  2750940/3250940     String#split
                      1.244      1.244      0.000      0.000  8252820/9252820     String#to_i
                      0.393      0.393      0.000      0.000  2750940/2750940     String#rstrip!
--------------------------------------------------------------------------------
                      7.056      0.589      0.000      6.467    500000/500000     Kernel#loop
  18.13%   1.51%      7.056      0.589      0.000      6.467           500000     Stats#update_global_stat
                      6.177      0.337      0.000      5.840    500000/500000     SortedSet#merge
                      0.162      0.162      0.000      0.000   500000/1500000     UserSessions#sessions_browsers
                      0.127      0.127      0.000      0.000   500000/1000000     UserSessions#sessions_count
--------------------------------------------------------------------------------
                      6.177      0.337      0.000      5.840    500000/500000     Stats#update_global_stat
  15.87%   0.87%      6.177      0.337      0.000      5.840           500000     SortedSet#merge
                      5.840      0.479      0.000      5.362    500000/500000     Set#merge
--------------------------------------------------------------------------------
                      5.840      0.479      0.000      5.362    500000/500000     SortedSet#merge
  15.01%   1.23%      5.840      0.479      0.000      5.362           500000     Set#merge
                      5.207      0.597      0.000      4.609    500000/500000     Set#do_with_enum
                      0.078      0.078      0.000      0.000    500000/500000     Kernel#instance_of?
                      0.077      0.077      0.000      0.000    500000/500001     Kernel#class
--------------------------------------------------------------------------------
                      5.207      0.597      0.000      4.609    500000/500000     Set#merge
  13.38%   1.53%      5.207      0.597      0.000      4.609           500000     Set#do_with_enum
                      4.506      0.213      0.000      4.293    500000/500000     Enumerable#each_entry
                      0.103      0.103      0.000      0.000   500000/3250941     Kernel#respond_to?
--------------------------------------------------------------------------------
                      4.506      0.213      0.000      4.293    500000/500000     Set#do_with_enum
  11.58%   0.55%      4.506      0.213      0.000      4.293           500000     Enumerable#each_entry
                      4.293      0.927      0.000      3.366    500000/500016     Array#each
--------------------------------------------------------------------------------
                      0.000      0.000      0.000      0.000         1/500016     SortedSet#each
                      0.006      0.000      0.000      0.005        15/500016     Enumerable#find
                      4.293      0.927      0.000      3.366    500000/500016     Enumerable#each_entry
  11.04%   2.38%      4.299      0.927      0.000      3.371           500016    *Array#each
                      3.366      1.837      0.000      1.529  2750940/2750940     SortedSet#add
                      0.005      0.000      0.000      0.004          154/154     Gem::BasicSpecification#contains_requirable_file?
                      0.001      0.000      0.000      0.001          154/154     <Module::Gem::BundlerVersionFinder>#compatible?
                      0.000      0.000      0.000      0.000           56/611     <Class::File>#file?
                      0.000      0.000      0.000      0.000           56/364     Kernel#untaint
--------------------------------------------------------------------------------
                      0.000      0.000      0.000      0.000         1/500001     <Class::IO>#open
                      4.261      2.775      0.000      1.486    500000/500001     Kernel#loop
  10.95%   7.13%      4.261      2.775      0.000      1.486           500001     <Module::Oj>#dump
                      1.486      1.486      0.000      0.00013500027/13500027     Hash#has_key?
--------------------------------------------------------------------------------
                      0.659      0.659      0.000      0.000   500000/3250940     <Module::Parsers>#parse_user
                      3.341      3.341      0.000      0.000  2750940/3250940     <Module::Parsers>#parse_session
  10.28%  10.28%      4.000      4.000      0.000      0.000          3250940     String#split
--------------------------------------------------------------------------------
                      3.366      1.837      0.000      1.529  2750940/2750940     Array#each
   8.65%   4.72%      3.366      1.837      0.000      1.529          2750940     SortedSet#add
                      1.179      1.179      0.000      0.000  2750940/2750940     Set#add
                      0.350      0.350      0.000      0.000  2750940/3250941     Kernel#respond_to?
--------------------------------------------------------------------------------
                      3.351      0.235      3.116      0.000    500000/500000     Kernel#loop
   8.61%   0.60%      3.351      0.235      3.116      0.000           500000     Enumerator#peek
                      0.000      0.000      0.000      0.000              1/3     Exception#exception
                      0.000      0.000      0.000      0.000              1/3     Exception#backtrace
--------------------------------------------------------------------------------
                      0.142      0.142      0.000      0.000   500000/1000000     UserSessions#used_ie?
                      2.760      0.365      0.000      2.396   500000/1000000     UserSessions#stats
   7.46%   1.30%      2.903      0.507      0.000      2.396          1000000     UserSessions#browsers
                      1.953      0.246      0.000      1.707   500000/1500000     UserSessions#sessions_browsers
                      0.443      0.443      0.000      0.000    500000/500001     Array#join
--------------------------------------------------------------------------------
                      0.597      0.597      0.000      0.000   500000/1500000     UserSessions#sessions_dates
                      0.632      0.632      0.000      0.000   500000/1500000     UserSessions#session_times
                      1.227      0.834      0.000      0.393   500000/1500000     UserSessions#sessions_browsers
   6.31%   5.30%      2.456      2.063      0.000      0.393          1500000     Array#map
                      0.393      0.393      0.000      0.000  2750940/2750940     String#upcase!
--------------------------------------------------------------------------------
                      0.128      0.128      0.000      0.000   500000/1500000     UserSessions#always_used_chrome?
                      0.162      0.162      0.000      0.000   500000/1500000     Stats#update_global_stat
                      1.953      0.246      0.000      1.707   500000/1500000     UserSessions#browsers
   5.76%   1.38%      2.243      0.536      0.000      1.707          1500000     UserSessions#sessions_browsers
                      1.227      0.834      0.000      0.393   500000/1500000     Array#map
                      0.481      0.481      0.000      0.000   500000/1000001     Array#sort!
--------------------------------------------------------------------------------
                      1.719      0.262      0.000      1.457    500000/500000     Class#new
   4.42%   0.67%      1.719      0.262      0.000      1.457           500000     User#initialize
                      1.457      0.579      0.000      0.878    500000/500000     <Module::Parsers>#parse_user
--------------------------------------------------------------------------------
                      1.527      0.420      0.000      1.107    500000/500000     UserSessions#stats
   3.92%   1.08%      1.527      0.420      0.000      1.107           500000     UserSessions#total_time
                      0.857      0.226      0.000      0.632   500000/1000000     UserSessions#session_times
                      0.134      0.134      0.000      0.000   500000/1000000     Integer#to_s
                      0.116      0.116      0.000      0.000    500000/500000     Array#sum
--------------------------------------------------------------------------------
                      1.486      1.486      0.000      0.00013500027/13500027     <Module::Oj>#dump
   3.82%   3.82%      1.486      1.486      0.000      0.000         13500027     Hash#has_key?
--------------------------------------------------------------------------------
                      0.219      0.219      0.000      0.000  1000000/9252820     <Module::Parsers>#parse_user
                      1.244      1.244      0.000      0.000  8252820/9252820     <Module::Parsers>#parse_session
   3.76%   3.76%      1.464      1.464      0.000      0.000          9252820     String#to_i
--------------------------------------------------------------------------------
                      1.457      0.579      0.000      0.878    500000/500000     User#initialize
   3.74%   1.49%      1.457      0.579      0.000      0.878           500000     <Module::Parsers>#parse_user
                      0.659      0.659      0.000      0.000   500000/3250940     String#split
                      0.219      0.219      0.000      0.000  1000000/9252820     String#to_i
--------------------------------------------------------------------------------
                      1.401      0.229      0.000      1.172    500000/500000     UserSessions#stats
   3.60%   0.59%      1.401      0.229      0.000      1.172           500000     UserSessions#always_used_chrome?
                      1.045      0.223      0.000      0.822    500000/500000     Array#all?
                      0.128      0.128      0.000      0.000   500000/1500000     UserSessions#sessions_browsers
--------------------------------------------------------------------------------
                      1.372      0.288      0.000      1.085    500000/500000     UserSessions#stats
   3.53%   0.74%      1.372      0.288      0.000      1.085           500000     UserSessions#sessions_dates
                      0.597      0.597      0.000      0.000   500000/1500000     Array#map
                      0.403      0.403      0.000      0.000   500000/1000001     Array#sort!
                      0.085      0.085      0.000      0.000    500000/500000     Array#reverse!
--------------------------------------------------------------------------------
                      1.179      1.179      0.000      0.000  2750940/2750940     SortedSet#add
   3.03%   3.03%      1.179      1.179      0.000      0.000          2750940     Set#add
--------------------------------------------------------------------------------
                      1.045      0.223      0.000      0.822    500000/500000     UserSessions#always_used_chrome?
   2.68%   0.57%      1.045      0.223      0.000      0.822           500000     Array#all?
                      0.822      0.822      0.000      0.000  1170913/1170913     Regexp#===
--------------------------------------------------------------------------------
                      0.141      0.141      0.000      0.000   500000/1000000     UserSessions#longest_session
                      0.857      0.226      0.000      0.632   500000/1000000     UserSessions#total_time
   2.57%   0.94%      0.999      0.367      0.000      0.632          1000000     UserSessions#session_times
                      0.632      0.632      0.000      0.000   500000/1500000     Array#map
--------------------------------------------------------------------------------
                      0.000      0.000      0.000      0.000        4/1500003     <Class::IO>#open
                      0.941      0.941      0.000      0.000  1499999/1500003     Kernel#loop
   2.42%   2.42%      0.941      0.941      0.000      0.000          1500003     IO#write
--------------------------------------------------------------------------------
                      0.000      0.000      0.000      0.000        1/1000001     SortedSet#to_a
                      0.403      0.403      0.000      0.000   500000/1000001     UserSessions#sessions_dates
                      0.481      0.481      0.000      0.000   500000/1000001     UserSessions#sessions_browsers
   2.27%   2.27%      0.884      0.884      0.000      0.000          1000001     Array#sort!
--------------------------------------------------------------------------------
                      0.822      0.822      0.000      0.000  1170913/1170913     Array#all?
   2.11%   2.11%      0.822      0.822      0.000      0.000          1170913     Regexp#===

* indicates recursively called methods
Measure Mode: wall_time
Thread ID: 70251463237120
Fiber ID: 70251484120680
Total Time: 38.91414403915405
Sort by: total_time

  %total   %self      total       self       wait      child            calls     name
--------------------------------------------------------------------------------
                     38.914      0.000      0.000     38.914              1/2     Enumerator::Generator#each
 100.00%   0.00%     38.914      0.000      0.000     38.914                2    *Enumerator#each
                     38.914      0.000      0.000     38.914              1/1     Enumerator::Generator#each
                     38.914      2.441      0.000     36.473              1/1     <Class::IO>#foreach
--------------------------------------------------------------------------------
                     38.914      0.000      0.000     38.914              1/1     Enumerator#each
 100.00%   0.00%     38.914      0.000      0.000     38.914                1     Enumerator::Generator#each
                     38.914      0.000      0.000     38.914              1/2     Enumerator#each
                      0.000      0.000      0.000      0.000         1/500000     Enumerator::Yielder#<<
--------------------------------------------------------------------------------
                     38.914      2.441      0.000     36.473              1/1     Enumerator#each
 100.00%   6.27%     38.914      2.441      0.000     36.473                1     <Class::IO>#foreach
                     35.979      0.181     35.798      0.000    499999/500000     Enumerator::Yielder#<<
                      0.494      0.494      0.000      0.000  3250940/3250940     String#start_with?
--------------------------------------------------------------------------------
                      0.000      0.000      0.000      0.000         1/500000     Enumerator::Generator#each
                     35.979      0.181     35.798      0.000    499999/500000     <Class::IO>#foreach
  92.46%   0.47%     35.979      0.181     35.798      0.000           500000     Enumerator::Yielder#<<

* indicates recursively called methods
Run options: --seed 9166

# Running:

bench_work	 0.001270	 0.000559	 0.000806	 0.005420	 0.046953	 0.388790
.

Finished in 8.902777s, 0.1123 runs/s, 0.1123 assertions/s.

1 runs, 1 assertions, 0 failures, 0 errors, 0 skips
micro@Micro ~/D/t/t/new>
```
